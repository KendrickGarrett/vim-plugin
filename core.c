#ifndef new_c#define new_c#include <stdio.h>#include <stdarg.h>#include <stdlib.h>#include <string.h>#include <assert.h>#include "core.h"void* new (struct IClass* class, ...) { //assert(class && class->construct && class->sizeOf); void* this = 0; unsigned int sizeOf; va_list args; va_start (args, class); if( ( sizeOf = class->SizeOfCls() ) > 0 ) {  this = malloc(sizeOf);  if(!this) {   printf("Failed to allocate memory");   return 0;  } } this = class->Construct(this, &args); va_end (args); return this;}/*void* new1 (struct IClass* class, ...) { __asm { push eax call SizeOfClass cmp eax, 0 je CALL_CONSRUCT  push eax call malloc CALL_CONSTRUCT: call    pop eax }}*/void delete (void* object) { struct IClass* this = object; //assert ( this->Destruct ); if( this->Destruct( this) ) {  free (object);  this = 0; }}#undef NULLPTR#endif
